{% extends 'admin/base.html' %}
{% load static %}

{% block title %}Dashboard Admin{% endblock %}

{% block body %}


<!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Saira:wght@500;600;700&display=swap" rel="stylesheet"> 

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Libraries Stylesheet -->
    <link href="{% static 'user/lib//animate/animate.min.css" rel="stylesheet'%}">
    <link href="{% static 'user/lib//owlcarousel/assets/owl.carousel.min.css' %}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="{% static 'user/css/bootstrap.min.css'%}" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="{% static 'user/css/style.css'%}" rel="stylesheet">


    {% comment %} # carosselle d'image Equipes {% endcomment %}
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    
    <script>
        @media (min-width: 500px) {
            .marginTop{
                margin-top: -150px;
            }
        }

    </script>
    

<div class="container-xxl bg-light my-5 py-5" id="evenements" style = "">
    <div class="container py-5 " style = "">
        {% comment %} <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px;"> {% endcomment %}
        <div class="text-center mx-auto mb-5 wow" data-wow-delay="0.1s" style="max-width: 500px;">
            <h1 class="marginTop">Catégories d'événements</h1>
            <a href="{% url 'ajoutTypeEvenement' %}" class="btn mb-3" style = "background-color: #ff6600 !important; border: solid 1px black!important;color: white;">
                <i class="fas fa-plus-circle me-2"></i>Ajouter une catégorie
            </a>
        </div>

        <div class="table-responsive rounded-3 shadow-lg">
            <table class="table table-hover align-middle">
                <thead style="background-color:#141A32 !important; color: white !important;">
                    <tr>
                        <th style="width: 100px; color: white;">Image</th>
                        <th style="color: white;">Nom de la catégorie</th>
                        <th style="color: white;">Description</th>
                        <th style="color: white;">Nombre d'événements</th>
                        <th style="color: white;">Actions</th>
                    </tr>
                </thead>

                <tbody>
                    {% for type_evenement in typeEvenement %}
                    <tr class="position-relative">
                        <td>
                            {% if type_evenement.image_type_evenement %}
                                <img src="{{ type_evenement.image_type_evenement.url }}" 
                                    class="img-thumbnail" 
                                    alt="{{ type_evenement.nom_type_evenement }}"
                                    style="width: 80px; height: 60px; object-fit: cover">
                            {% else %}
                                <div class="bg-secondary text-center py-2" style="width: 70px; height: 60px; border-radius: 10px;">
                                    <i class="fas fa-image text-white fs-4"></i>
                                </div>
                            {% endif %}
                        </td>
                        <td class="fw-bold">{{ type_evenement.nom_type_evenement }}</td>
                        <td>
                            <div class="description-container" data-bs-toggle="tooltip" 
                                 title="{{ type_evenement.description_type_evenement }}">
                                {{ type_evenement.description_type_evenement|truncatechars:60 }}
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-primary rounded-pill">
                                {{ type_evenement.nombreEvenemnet  }}
                            </span>
                        </td>
                        <td>
                            <div class="d-flex gap-2">
                                <a href="{% url 'evenementFiltrer' type_evenement.id %}" 
                                   class="btn btn-sm btn-outline-primary"
                                   data-bs-toggle="tooltip" title="Voir les événements">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{% url 'modifierCategorie' type_evenement.id %}" 
                                   class="btn btn-sm btn-outline-success"
                                   data-bs-toggle="tooltip" title="Modifier">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{% url 'supprimerCategorie' type_evenement.id %}" 
                                   class="btn btn-sm btn-outline-danger"
                                   onclick = "return confirm('Voulez-vous supprimer cette catégorie ?')"
                                   data-bs-toggle="tooltip" title="Supprimer">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <nav class="mt-4">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1">&laquo; Première</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Précédent</a>
                </li>
                {% endif %}

                <li class="page-item disabled">
                    <span class="page-link">
                        Page {{ page_obj.number }} sur {{ page_obj.paginator.num_pages }}
                    </span>
                </li>

                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}">Suivant</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Dernière &raquo;</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>

<!-- Modal Preview Image -->
<div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                <img src="" id="modalPreviewImage" class="img-fluid" alt="Preview">
            </div>
        </div>
    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: rgba(13, 110, 253, 0.05);
        transition: background-color 0.2s ease;
    }
    .description-container {
        cursor: help;
        max-width: 300px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .img-thumbnail {
        transition: transform 0.2s ease;
        cursor: pointer;
    }
    .img-thumbnail:hover {
        transform: scale(1.1);
    }
</style>

<script>
    // Activation des tooltips Bootstrap
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

    // Preview des images en modal
    document.querySelectorAll('.img-thumbnail').forEach(img => {
        img.addEventListener('click', function() {
            if(this.src) {
                document.getElementById('modalPreviewImage').src = this.src
                const modal = new bootstrap.Modal(document.getElementById('imagePreviewModal'))
                modal.show()
            }
        })
    })

    // Confirmation avant suppression
    document.querySelectorAll('.btn-outline-danger').forEach(btn => {
        btn.addEventListener('click', function(e) {
            if(!confirm('Êtes-vous sûr de vouloir supprimer cette catégorie ?')) {
                e.preventDefault()
            }
        })
    })
</script>
<!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    {% comment %} <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script> {% endcomment %}
    <script src="{% static 'user/lib//wow/wow.min.js'%}"></script>
    <script src="{% static 'user/lib//easing/easing.min.js'%}"></script>
    <script src="{% static 'user/lib//waypoints/waypoints.min.js'%}"></script>
    <script src="{% static 'user/lib//owlcarousel/owl.carousel.min.js'%}"></script>
    <script src="{% static 'user/lib//parallax/parallax.min.js'%}"></script>

    <!-- Template Javascript -->
    <script src="{% static 'user/js//main.js'%} "></script>
{% endblock %}