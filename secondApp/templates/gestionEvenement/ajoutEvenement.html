{% extends 'base.html' %}

{% load static %}

{% block title %}Ajouter Événement{% endblock %}

{% block style %}
  <style>
      :root {
          --primary: #FF6F0F;
          --dark: #1a2035;
          --light: #f8f9fa;
          --white: #ffffff;
          --border: #dee2e6;
          --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      /* Header */
      .page-header {
          background-color: var(--dark);
          color: var(--white);
          padding: 2rem 0;
          margin-top: 15px;
          margin-bottom: 2rem;
      }
      
      .page-title {
          font-size: 2rem;
          font-weight: 600;
          margin-bottom: 0.5rem;
      }
      
      .page-subtitle {
          opacity: 0.9;
      }
      
      .container-custom {
          max-width: 1000px;
          margin: 0 auto;
          padding: 0 1rem;
      }
      
      /* Card */
      .form-card {
          background: var(--white);
          border-radius: 8px;
          box-shadow: var(--shadow);
          margin-bottom: 2rem;
      }
      
      .card-header-custom {
          background-color: var(--dark);
          color: var(--white);
          padding: 1.5rem;
          border-radius: 8px 8px 0 0;
      }
      
      .card-title {
          font-size: 1.5rem;
          font-weight: 600;
          margin: 0;
          display: flex;
          align-items: center;
          gap: 0.75rem;
      }
      
      .card-body-custom {
          padding: 2rem;
      }
      
      /* Form Sections */
      .form-section {
          margin-bottom: 2rem;
          padding-bottom: 1.5rem;
          border-bottom: 1px solid var(--border);
      }
      
      .form-section:last-child {
          border-bottom: none;
      }
      
      .section-title {
          font-size: 1.25rem;
          color: var(--dark);
          margin-bottom: 1.5rem;
          font-weight: 600;
          display: flex;
          align-items: center;
          gap: 0.75rem;
      }
      
      /* Form Elements */
      .form-group {
          margin-bottom: 1.5rem;
      }
      
      label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--dark);
      }
      
      input[type="text"],
      input[type="number"],
      textarea,
      select {
          width: 100%;
          padding: 0.6rem 1rem;
          border: 1px solid var(--border);
          border-radius: 6px;
          font-size: 1rem;
          transition: border-color 0.2s;
      }
      
      input[type="text"]:focus,
      input[type="number"]:focus,
      textarea:focus,
      select:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(255, 111, 15, 0.1);
      }
      
      textarea {
          resize: vertical;
          min-height: 120px;
      }
      
      /* Upload Area */
      .upload-area {
          border: 2px dashed var(--border);
          border-radius: 6px;
          padding: 2rem;
          text-align: center;
          background-color: var(--light);
          transition: border-color 0.2s;
          cursor: pointer;
      }
      
      .upload-area:hover {
          border-color: var(--primary);
      }
      
      .upload-area i {
          font-size: 3rem;
          color: var(--primary);
          margin-bottom: 1rem;
          display: block;
      }
      
      .upload-area p {
          margin: 0.5rem 0;
          color: #6c757d;
      }
      
      .upload-area p:first-of-type {
          font-weight: 500;
          color: var(--dark);
          font-size: 1.1rem;
      }
      
      #fileInput {
          display: none;
      }
      
      /* Preview Container */
      .preview-container {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
          gap: 1rem;
          margin-top: 1.5rem;
      }
      
      .preview-item {
          position: relative;
          width: 100%;
          height: 150px;
          border-radius: 6px;
          overflow: hidden;
          border: 1px solid var(--border);
      }
      
      .preview-item img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }
      
      .preview-item .remove-btn {
          position: absolute;
          top: 5px;
          right: 5px;
          background-color: var(--primary);
          color: var(--white);
          border: none;
          width: 30px;
          height: 30px;
          border-radius: 50%;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          opacity: 0;
          transition: opacity 0.2s;
      }
      
      .preview-item:hover .remove-btn {
          opacity: 1;
      }
      
      /* Buttons */
      .form-actions {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: 2rem;
          padding-top: 1.5rem;
          border-top: 1px solid var(--border);
      }
      
      .btn-cancel {
          background-color: var(--dark);
          color: var(--white);
          border: none;
          border-radius: 6px;
          padding: 0.6rem 1.5rem;
          font-weight: 500;
          text-decoration: none;
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          transition: background-color 0.2s;
      }
      
      .btn-cancel:hover {
          background-color: #0f1420;
          color: var(--white);
      }
      
      .btn-submit {
          background-color: var(--primary);
          color: var(--white);
          border: none;
          border-radius: 6px;
          padding: 0.6rem 2rem;
          font-weight: 500;
          cursor: pointer;
          transition: background-color 0.2s;
      }
      
      .btn-submit:hover {
          background-color: #e05b00;
      }
      
      /* Responsive */
      @media(max-width: 768px) {
          .page-title {
              font-size: 1.5rem;
          }
          
          .card-title {
              font-size: 1.25rem;
          }
          
          .form-actions {
              flex-direction: column;
              gap: 1rem;
          }
          
          .btn-cancel,
          .btn-submit {
              width: 100%;
              justify-content: center;
          }
          
          .preview-container {
              grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
          }
          
          .preview-item {
              height: 100px;
          }
      }
  </style>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

{% endblock %}

{% block body %}
<!-- Page Header -->
<header class="page-header">
    <div class="container-custom text-center">
        <h1 class="page-title text-white">➕ Ajouter un Événement</h1>
        <p class="page-subtitle">Créez un nouvel événement avec photos</p>
    </div>
</header>

<div class="page-inner">
    <div class="container-custom">
        <!-- Carte du formulaire -->
        <div class="form-card">
            <!-- En-tête -->
            <div class="card-header-custom">
                <h3 class="card-title text-white">
                    <i class="fas fa-calendar-plus"></i>
                    Nouvel Événement
                </h3>
            </div>
            
            <!-- Corps -->
            <div class="card-body-custom">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Section Informations -->
                    <div class="form-section">
                        <h4 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            Informations de l'événement
                        </h4>
                        
                        <div class="form-group">
                            <label for="type_evenement">Catégorie d'événement*</label>
                            <select name="type_evenement" id="type_evenement" required>
                                <option value="">Choisir un type d'événement</option>
                                {% for typeEve in typeEvenem %}
                                    <option value="{{ typeEve.id }}">{{ typeEve.nom_type_evenement }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="annee">Année pour l'événement*</label>
                            <select name="annee" id="annee" required>
                                <option value="">Choisir une année</option>
                                {% for toutes_annee in toutes_annees %}
                                    <option value="{{ toutes_annee.id }}">{{ toutes_annee.debutAnnee|date:"Y" }}- {{ toutes_annee.finAnnee|date:"Y" }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="titre">Titre de l'evenement</label>
                            <input type="text" id="titre" name="titre" placeholder="Entrez le titre de l'evenement" step = "25" min ="0">
                        </div>

                        <div class="form-group">
                            <label for="montant">Prix (FCFA)</label>
                            <input type="number" id="montant" name="montant" placeholder="Entrez le montant (optionnel)" step = "25" min ="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="description">Description*</label>
                            <textarea id="description" name="description" placeholder="Écrivez la description..." required></textarea>
                        </div>
                    </div>
                    
                    <!-- Section Photos -->
                    <div class="form-section">
                        <h4 class="section-title">
                            <i class="fas fa-images"></i>
                            Photos de l'événement
                        </h4>
                        
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Glissez-déposez vos images ici</p>
                            <p>ou cliquez pour sélectionner des images</p>
                            <input type="file" id="fileInput" accept="image/*" name="photos[]" multiple>
                        </div>
                        
                        <div class="preview-container" id="previewContainer"></div>
                    </div>
                    
                    <!-- Boutons -->
                    <div class="form-actions">
                        <a href="{% url 'affichageEvenement' %}" class="btn-cancel">
                            <i class="fas fa-arrow-left"></i> Annuler
                        </a>
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-save"></i> Créer l'événement
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const previewContainer = document.getElementById('previewContainer');
    
    // Clic sur la zone d'upload
    uploadArea.addEventListener('click', () => fileInput.click());
    
    // Drag and drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => {
            uploadArea.style.borderColor = 'var(--primary)';
        });
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => {
            uploadArea.style.borderColor = 'var(--border)';
        });
    });
    
    // Gestion des fichiers déposés
    uploadArea.addEventListener('drop', function(e) {
        const files = e.dataTransfer.files;
        handleFiles(files);
    });
    
    // Gestion des fichiers sélectionnés
    fileInput.addEventListener('change', function() {
        handleFiles(this.files);
    });
    
    // Affichage des prévisualisations
    function handleFiles(files) {
        [...files].forEach(file => {
            if (!file.type.match('image.*')) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                const img = document.createElement('img');
                img.src = e.target.result;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '&times;';
                removeBtn.type = 'button';
                removeBtn.addEventListener('click', () => {
                    previewItem.remove();
                });
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                previewContainer.appendChild(previewItem);
            }
            
            reader.readAsDataURL(file);
        });
    }
});
</script>
{% endblock %}